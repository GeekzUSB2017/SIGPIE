(dp1
S'output'
p2
S"<type 'exceptions.AttributeError'> 'Table' object has no attribute 'usbid'"
p3
sS'layer'
p4
S'/home/julio/git/SIGPIE/applications/SIGPIE/controllers/home.py'
p5
sS'code'
p6
S'# -*- coding: utf-8 -*-\n\n\n\ndef index():\n\treturn dict()\n\ndef about():\n\treturn dict()\n\n\ndef postularse():\n\treturn dict()\n\n\ndef user():\n\treturn dict(login=auth.login())\n\ndef register():\n\treturn dict(form=auth.register())\n\n\nURL_RETORNO = "http%3A%2F%2Flocalhost%3A8000%2FSIGPIE%2Fhome%2Flogin_cas"\n\n# FUNCIONES USUARIO\n\ndef login_cas():\n\tif not request.vars.getfirst(\'ticket\'):\n\t\t#redirect(URL(\'error\'))\n\t\tpass\n\ttry:\n\t\timport urllib2, ssl\n\t\tssl._create_default_https_context = ssl._create_unverified_context\n\n\t\turl = "https://secure.dst.usb.ve/validate?ticket="+\\\n\t\trequest.vars.getfirst(\'ticket\') + "&service=" + URL_RETORNO\n\n\n\t\treq = urllib2.Request(url)\n\t\tresponse = urllib2.urlopen(req)\n\t\tthe_page = response.read()\n\n\n\texcept Exception, e:\n\t\tprint "Exception: "\n\t\tprint e\n\t\t# redirect(URL(\'error\'))\n\n\tif the_page[0:2] == "no":\n\t\tpass\n\telse:\n\t\t# session.casticket = request.vars.getfirst(\'ticket\')\n\t\tdata  = the_page.split()\n\t\tusbid = data[1]\n\n\t\tusuario = get_ldap_data(usbid) #Se leen los datos del CAS\n\n\t\ttablaUsuarios = db.estudiante\n\n\t\tsession.usuario = usuario\n\t\tsession.usuario[\'usbid\'] = usbid\n\t\ttry:\n\t\t\tprint "Informaci\xc3\xb3n extraida del CAS: "\n\t\t\tprint usuario[\'usbid\']\n\t\t\tprint usuario[\'first_name\']\n\t\t\tprint usuario[\'last_name\']\n\t\t\tprint usuario[\'email\']\n\t\t\tprint usuario[\'cedula\']\n\t\t\tprint usuario[\'phone\']\n\t\t\tprint usuario[\'tipo\']\n\n\n\t\texcept:\n\t\t\tprint(\'Excepci\xc3\xb3n\')\n\t\tif db(tablaUsuarios.carnet == usbid).isempty():\n\t\t\tdatosUsuario = db(tablaUsuarios.usbid==usbid).select()[0]\n\n\t\t\tdb.estudiante.insert(cedula=session.usuario["cedula"],  # Lo insertamos en la base de datos.\n\t\t\tcarnet=session.usuario["usbid"],\n\t\t\tnombre=session.usuario["first_name"],\n\t\t\tapellido=session.usuario["last_name"],\n\t\t\ttelefono_habitacion=session.usuario["phone"])\n\n\n\t\t\tprint "se agrego un nuevo usuario"\n\t\t\tredirect(URL(\'about\'))\n\n\t\tredirect(URL(\'about\'))\n\ndef logout_cas():\n\tsession.usuario = None\n\treturn response.render()\n\n\n\n\n################\n# SEPARAR      # Todo esto va a usbutils.py, en SIGPIE/modules, pero me daba error al importar usbutils.py\n################\n\n\nimport ldap\nimport string\nimport random\n\n# Requiere:\n# sudo apt-get install libsasl2-dev python-dev libldap2-dev libssl-dev ldap-utils\n# pip install ldap\n\ndef get_ldap_data(usbid):\n\tdef getFirst(maybeList):\n\t\t# Evitar excepcion de index no encontrado\n\t\tif type(maybeList)==list and len(maybeList)>0:\n\t\t\treturn maybeList[0]\n\t\telse:\n\t\t\treturn None\n\n\tuser = {}\n\tl    = ldap.open("ldap.usb.ve")\n\tsearchScope        = ldap.SCOPE_SUBTREE\n\tretrieveAttributes = None #Traemos todos los atributos\n\tbaseDN = "ou=People,dc=usb,dc=ve"\n\tsearchFilter = "uid=*"+usbid+"*"\n\tldap_result_id = l.search(baseDN,searchScope,searchFilter,retrieveAttributes)\n\tresult_type, consulta = l.result(ldap_result_id, 0)\n\tdatos = consulta[0][1]\n\n\t# print datos\n\n\t# Extraer datos evitando campos inexistentes\n\tuser[\'first_name\'] = getFirst(datos.get(\'givenName\'))\n\tuser[\'last_name\']  = getFirst(datos.get(\'sn\'))\n\tuser[\'email\']      = getFirst(datos.get(\'mail\'))\n\tuser[\'cedula\']     = getFirst(datos.get(\'personalId\'))\n\tuser[\'phone\']      = getFirst(datos.get(\'mobile\'))\n\tuser_type          = getFirst(datos.get(\'gidNumber\'))\n\n\tif user_type == "1000":\n\t\tuser[\'tipo\'] = "Docente"\n\t\tuser[\'dpto\'] = getFirst(datos.get(\'department\'))\n\telif user_type == "1002":\n\t\tuser[\'tipo\'] = "Empleado"\n\telif user_type == "1003":\n\t\tuser[\'tipo\'] = "Organizaci\xc3\xb3n"\n\telif user_type == "1004":\n\t\tuser[\'tipo\'] = "Pregrado"\n\t\tuser[\'carrera\'] = getFirst(datos.get(\'career\'))\n\telif user_type == "1006":\n\t\tuser[\'tipo\'] = "Postgrado"\n\t\tuser[\'carrera\'] = getFirst(datos.get(\'career\'))\n\telif user_type == "1007":\n\t\tuser[\'tipo\'] = "Egresado"\n\telif user_type == "1008":\n\t\tuser[\'tipo\'] = "Administrativo"\n\n\treturn user\n\ndef random_key():\n\treturn \'\'.join(random.choice(string.ascii_uppercase) for _ in range(20))\n\n\n\nresponse._vars=response._caller(login_cas)\n'
p7
sS'snapshot'
p8
(dp9
sS'traceback'
p10
S'Traceback (most recent call last):\n  File "/home/julio/git/SIGPIE/gluon/restricted.py", line 227, in restricted\n    exec ccode in environment\n  File "/home/julio/git/SIGPIE/applications/SIGPIE/controllers/home.py", line 163, in <module>\n  File "/home/julio/git/SIGPIE/gluon/globals.py", line 417, in <lambda>\n    self._caller = lambda f: f()\n  File "/home/julio/git/SIGPIE/applications/SIGPIE/controllers/home.py", line 76, in login_cas\n    datosUsuario = db(tablaUsuarios.usbid==usbid).select()[0]\nAttributeError: \'Table\' object has no attribute \'usbid\'\n'
p11
s.